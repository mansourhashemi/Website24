<!doctype html>
<html lang="fa" dir="rtl"> 
 <head> 
  <meta charset="utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <title>Ø³ÙˆÙ¾Ø±Ù…Ø§Ø±Ú©Øª Ø¢Ù†Ù„Ø§ÛŒÙ† â€” Ø¯Ù…ÙˆÛŒ ØªÚ©â€ŒÙØ§ÛŒÙ„ÛŒ</title> 
  <meta name="description" content="Ø¯Ù…ÙˆÛŒ Ø³ÙˆÙ¾Ø±Ù…Ø§Ø±Ú©Øª Ø¢Ù†Ù„Ø§ÛŒÙ†: Ø¬Ø³ØªØ¬ÙˆØŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒØŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ØŒ Ú©Ø¯ØªØ®ÙÛŒÙØŒ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø±Ø³Ø§Ù„"> 
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin> 
  <script src="https://cdn.tailwindcss.com"></script> 
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#00C853',
            primaryDark: '#00A844',
          }
        }
      },
      corePlugins: {
        preflight: true
      }
    }
  </script> 
  <style>
    html, body { height: 100%; }
    /* Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø³Ø¨Ø¯ */
    .scroll-area { scrollbar-width: thin; }
    .scroll-area::-webkit-scrollbar { width: 8px; }
    .scroll-area::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 8px; }
  </style> 
 </head> 
 <body class="bg-gray-50 text-gray-900"> <!-- Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ --> 
  <header class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b"> 
   <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3"> <button id="openCartTop" class="md:hidden p-2 rounded-xl border hover:bg-gray-50" aria-label="Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯"> ğŸ›’ </button> <a href="#" class="flex items-center gap-2 font-bold text-lg"> <span class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-primary text-white">ğŸ›ï¸</span> <span>Ø³ÙˆÙ¾Ø±Ù…Ø§Ø±Ú©Øª Ø¢Ù†Ù„Ø§ÛŒÙ†</span> </a> 
    <div class="ms-auto hidden md:flex items-center gap-3 w-[55%]"> 
     <div class="relative flex-1"> 
      <input id="search" class="w-full rounded-2xl border px-4 py-2 ps-10 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ù„Ø§ (Ù…Ø«Ù„Ø§Ù‹ Ø´ÛŒØ±ØŒ Ù†Ø§Ù†ØŒ Ù†ÙˆØ´Ø§Ø¨Ù‡...)"> <span class="absolute right-3 top-2.5">ğŸ”</span> 
     </div> <select id="city" class="rounded-2xl border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"> <option value="ØªÙ‡Ø±Ø§Ù†">ØªÙ‡Ø±Ø§Ù†</option> <option value="Ú©Ø±Ø¬">Ú©Ø±Ø¬</option> <option value="Ø§ØµÙÙ‡Ø§Ù†">Ø§ØµÙÙ‡Ø§Ù†</option> <option value="Ø´ÛŒØ±Ø§Ø²">Ø´ÛŒØ±Ø§Ø²</option> <option value="Ù…Ø´Ù‡Ø¯">Ù…Ø´Ù‡Ø¯</option> </select> <button id="loginBtn" class="rounded-2xl px-4 py-2 border hover:bg-gray-50">ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button> 
    </div> 
   </div> 
   <div class="md:hidden px-4 pb-3"> 
    <div class="relative"> 
     <input id="searchMobile" class="w-full rounded-2xl border px-4 py-2 ps-10 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ù„Ø§"> <span class="absolute right-3 top-2.5">ğŸ”</span> 
    </div> 
    <div class="mt-2 flex items-center gap-2"> <select id="cityMobile" class="flex-1 rounded-2xl border px-3 py-2"> <option>ØªÙ‡Ø±Ø§Ù†</option><option>Ú©Ø±Ø¬</option><option>Ø§ØµÙÙ‡Ø§Ù†</option><option>Ø´ÛŒØ±Ø§Ø²</option><option>Ù…Ø´Ù‡Ø¯</option> </select> <button id="loginBtnMobile" class="rounded-2xl px-4 py-2 border">ÙˆØ±ÙˆØ¯</button> 
    </div> 
   </div> 
  </header> <!-- Ø¨Ù†Ø± --> 
  <section class="bg-gradient-to-l from-primary to-primaryDark text-white"> 
   <div class="max-w-6xl mx-auto px-4 py-8 grid md:grid-cols-2 gap-6 items-center"> 
    <div> 
     <h1 class="text-2xl md:text-3xl font-bold leading-9">ØªØ­ÙˆÛŒÙ„ Ø³Ø±ÛŒØ¹Ù Ø§Ù‚Ù„Ø§Ù… Ø±ÙˆØ²Ù…Ø±Ù‡ Ø¯Ø±Ù Ù…Ù†Ø²Ù„</h1> 
     <p class="mt-2 text-white/90">Ø§Ø² Ù…ÛŒÙˆÙ‡ Ùˆ Ù„Ø¨Ù†ÛŒØ§Øª ØªØ§ ØªÙ†Ù‚Ù„Ø§Øª Ùˆ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒâ€”Ù‡Ù…Ù‡ Ø¯Ø± Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯Ø§Ø®Ù„ Ø³Ø¨Ø¯ Ø´Ù…Ø§.</p> 
     <div class="mt-4 flex gap-2"> <button id="openSlots" class="rounded-2xl bg-white text-primary px-4 py-2 font-semibold hover:bg_white/90">Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ù…Ø§Ù† Ø§Ø±Ø³Ø§Ù„</button> <a href="#products" class="rounded-2xl border border-white px-4 py-2 hover:bg-white/10">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª</a> 
     </div> 
    </div> 
    <div class="hidden md:block text-6xl text-center">
     ğŸ›µğŸ’¨
    </div> 
   </div> 
  </section> <!-- Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ --> 
  <section class="max-w-6xl mx-auto px-4 py-6"> 
   <div class="flex items-center gap-2 overflow-x-auto no-scrollbar pb-2" id="cats"> <!-- filled by JS --> 
   </div> 
  </section> <!-- Ù…Ø­ØµÙˆÙ„Ø§Øª --> 
  <main id="products" class="max-w-6xl mx-auto px-4 pb-32"> 
   <div id="grid" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div> 
  </main> <!-- Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ú©Ù†Ø§Ø±ÛŒ --> 
  <aside id="cartDrawer" class="fixed inset-y-0 left-0 w-full max-w-md bg-white shadow-2xl translate-x-[-110%] transition-transform duration-300 z-50 flex flex-col"> 
   <div class="p-4 border-b flex items-center gap-2"> <button id="closeCart" class="p-2 rounded-xl hover:bg-gray-50" aria-label="Ø¨Ø³ØªÙ†">â¬…ï¸</button> 
    <h2 class="font-bold text-lg">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h2> <span class="ms-auto text-sm text-gray-500" id="cartCity">Ø´Ù‡Ø±: ØªÙ‡Ø±Ø§Ù†</span> 
   </div> 
   <div id="cartItems" class="flex-1 overflow-y-auto scroll-area p-4 space-y-3"></div> 
   <div class="p-4 border-t space-y-3"> 
    <div class="flex items-center gap-2"> 
     <input id="coupon" class="flex-1 rounded-2xl border px-3 py-2" placeholder="Ú©Ø¯ ØªØ®ÙÛŒÙ"> <button id="applyCoupon" class="rounded-2xl px-4 py-2 border">Ø§Ø¹Ù…Ø§Ù„</button> 
    </div> 
    <div class="text-sm grid grid-cols-2 gap-y-1"> <span>Ø¬Ù…Ø¹ Ø¬Ø²:</span><span class="text-left" id="subtotal">0</span> <span>ØªØ®ÙÛŒÙ:</span><span class="text-left text-green-600" id="discount">0</span> <span>Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„:</span><span class="text-left" id="shipping">15000</span> <span class="font-bold">Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</span><span class="text-left font-bold" id="payable">0</span> 
    </div> <button id="checkout" class="w-full rounded-2xl bg-primary hover:bg-primaryDark text-white py-3 font-bold">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button> 
   </div> 
  </aside> <!-- Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ† Ù…ÙˆØ¨Ø§ÛŒÙ„ --> 
  <nav class="md:hidden fixed bottom-0 inset-x-0 bg-white border-t z-40"> 
   <div class="max-w-6xl mx-auto px-4 py-2 grid grid-cols-4 text-center text-sm"> <a href="#" class="py-1">ğŸ 
     <div>
      Ø®Ø§Ù†Ù‡
     </div></a> <button id="openCartBottom" class="py-1">ğŸ›’
     <div>
      Ø³Ø¨Ø¯
     </div></button> <a href="#products" class="py-1">ğŸ§º
     <div>
      Ù…Ø­ØµÙˆÙ„Ø§Øª
     </div></a> <button id="openSlots2" class="py-1">â±ï¸
     <div>
      Ø²Ù…Ø§Ù† Ø§Ø±Ø³Ø§Ù„
     </div></button> 
   </div> 
  </nav> <!-- Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ --> <dialog id="loginModal" class="rounded-2xl p-0 w-11/12 md:w-[420px]"> 
   <form method="dialog" class="p-4 space-y-3"> 
    <div class="flex items-center gap-2"> <span class="text-xl">ğŸ‘¤</span> 
     <h3 class="font-bold text-lg">ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h3> <button class="ms-auto p-2 rounded-xl hover:bg-gray-50">âœ–ï¸</button> 
    </div> 
    <input class="w-full rounded-2xl border px-3 py-2" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„"> <button class="w-full rounded-2xl bg-primary hover:bg-primaryDark text-white py-2">Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯</button> 
    <p class="text-xs text-gray-500">Ø§ÛŒÙ† ÙÙ‚Ø· ÛŒÚ© Ø¯Ù…Ùˆ Ø§Ø³Øª.</p> 
   </form> 
  </dialog> <dialog id="slotsModal" class="rounded-2xl p-0 w-11/12 md:w-[520px]"> 
   <form method="dialog" class="p-4 space-y-3"> 
    <div class="flex items-center gap-2"> <span class="text-xl">â±ï¸</span> 
     <h3 class="font-bold text-lg">Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²Ù‡Ù” Ø§Ø±Ø³Ø§Ù„</h3> <button class="ms-auto p-2 rounded-xl hover:bg-gray-50">âœ–ï¸</button> 
    </div> 
    <div id="slotGrid" class="grid grid-cols-2 md:grid-cols-3 gap-2"></div> <button class="w-full rounded-2xl bg-primary hover:bg-primaryDark text-white py-2">ØªØ£ÛŒÛŒØ¯</button> 
   </form> 
  </dialog> <dialog id="orderDone" class="rounded-2xl p-0 w-11/12 md:w-[420px]"> 
   <form method="dialog" class="p-4 space-y-3 text-center"> 
    <div class="text-5xl">
     âœ…
    </div> 
    <h3 class="font-bold text-lg">Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ø´Ø¯</h3> 
    <p class="text-sm text-gray-600">Ø§ÛŒÙ† ÛŒÚ© Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø§Ø³Øª Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p> <button class="w-full rounded-2xl border py-2">Ø¨Ø§Ø´Ù‡</button> 
   </form> 
  </dialog> <button id="floatingCart" class="hidden md:flex fixed bottom-6 left-6 items-center gap-2 rounded-full shadow-lg bg-primary hover:bg-primaryDark text-white px-4 py-3 z-40"> <span>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø³Ø¨Ø¯</span><span>ğŸ›’</span> </button> 
  <script>
    // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡
    const categories = [
      { id: 'all', name: 'Ù‡Ù…Ù‡' },
      { id: 'dairy', name: 'Ù„Ø¨Ù†ÛŒØ§Øª' },
      { id: 'bakery', name: 'Ù†Ø§Ù†ÙˆØ§ÛŒÛŒ' },
      { id: 'fruits', name: 'Ù…ÛŒÙˆÙ‡ Ùˆ Ø³Ø¨Ø²ÛŒ' },
      { id: 'drinks', name: 'Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ' },
      { id: 'snacks', name: 'ØªÙ†Ù‚Ù„Ø§Øª' },
      { id: 'hygiene', name: 'Ø¨Ù‡Ø¯Ø§Ø´Øª' },
    ];

    const products = [
      {id:1, title:'Ø´ÛŒØ± Ú©Ù…â€ŒÚ†Ø±Ø¨ Û± Ù„ÛŒØªØ±ÛŒ', price:38000, cat:'dairy', unit:'Ø¨Ø·Ø±ÛŒ', emoji:'ğŸ¥›'},
      {id:2, title:'Ù…Ø§Ø³Øª ÛŒÙˆÙ†Ø§Ù†ÛŒ Û¹Û°Û° Ú¯Ø±Ù…ÛŒ', price:115000, cat:'dairy', unit:'Ø¹Ø¯Ø¯', emoji:'ğŸ¥£'},
      {id:3, title:'Ù†Ø§Ù† Ø¨Ø±Ø¨Ø±ÛŒ ØªØ§Ø²Ù‡', price:18000, cat:'bakery', unit:'Ø¹Ø¯Ø¯', emoji:'ğŸ¥–'},
      {id:4, title:'Ù†Ø§Ù† ØªØ³Øª Ø³Ø¨ÙˆØ³â€ŒØ¯Ø§Ø±', price:65000, cat:'bakery', unit:'Ø¨Ø³ØªÙ‡', emoji:'ğŸ'},
      {id:5, title:'Ø³ÛŒØ¨ Ù‚Ø±Ù…Ø² Ù…Ù…ØªØ§Ø² Û± Ú©ÛŒÙ„Ùˆ', price:98000, cat:'fruits', unit:'Ú©ÛŒÙ„Ùˆ', emoji:'ğŸ'},
      {id:6, title:'Ù…ÙˆØ² Ø¯Ø±Ø¬Ù‡ ÛŒÚ© Û± Ú©ÛŒÙ„Ùˆ', price:125000, cat:'fruits', unit:'Ú©ÛŒÙ„Ùˆ', emoji:'ğŸŒ'},
      {id:7, title:'Ù†ÙˆØ´Ø§Ø¨Ù‡ Ú©ÙˆÙ„Ø§ Û±.Ûµ Ù„ÛŒØªØ±ÛŒ', price:42000, cat:'drinks', unit:'Ø¨Ø·Ø±ÛŒ', emoji:'ğŸ¥¤'},
      {id:8, title:'Ø¯ÙˆØº Ø³Ù†ØªÛŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡', price:53000, cat:'drinks', unit:'Ø¨Ø·Ø±ÛŒ', emoji:'ğŸ§‰'},
      {id:9, title:'Ú†ÛŒÙ¾Ø³ Ø³Ø§Ø¯Ù‡ Û¶Û° Ú¯Ø±Ù…ÛŒ', price:22000, cat:'snacks', unit:'Ø¨Ø³ØªÙ‡', emoji:'ğŸŸ'},
      {id:10, title:'Ø´Ú©Ù„Ø§Øª ØªØ®ØªÙ‡â€ŒØ§ÛŒ Û·Û°%', price:78000, cat:'snacks', unit:'ØªØ®ØªÙ‡', emoji:'ğŸ«'},
      {id:11, title:'Ù…Ø§ÛŒØ¹ Ø¯Ø³ØªØ´ÙˆÛŒÛŒ ÛµÛ°Û°ml', price:69000, cat:'hygiene', unit:'Ø¨Ø·Ø±ÛŒ', emoji:'ğŸ§´'},
      {id:12, title:'Ø¯Ø³ØªÙ…Ø§Ù„ Ú©Ø§ØºØ°ÛŒ Û²Û°Û° Ø¨Ø±Ú¯', price:84000, cat:'hygiene', unit:'Ø¨Ø³ØªÙ‡', emoji:'ğŸ§»'},
    ];

    const coupons = {
      'OFF20': 0.2,
      'WELCOME10': 0.1,
    };

    const shippingBase = 15000;

    // DOM refs
    const grid = document.getElementById('grid');
    const catWrap = document.getElementById('cats');
    const search = document.getElementById('search');
    const searchMobile = document.getElementById('searchMobile');
    const city = document.getElementById('city');
    const cityMobile = document.getElementById('cityMobile');

    // Ø³Ø¨Ø¯
    const cartBtnTop = document.getElementById('openCartTop');
    const cartBtnBottom = document.getElementById('openCartBottom');
    const floatingCart = document.getElementById('floatingCart');
    const cartDrawer = document.getElementById('cartDrawer');
    const closeCart = document.getElementById('closeCart');
    const cartItems = document.getElementById('cartItems');
    const subtotalEl = document.getElementById('subtotal');
    const discountEl = document.getElementById('discount');
    const shippingEl = document.getElementById('shipping');
    const payableEl = document.getElementById('payable');
    const couponInput = document.getElementById('coupon');
    const applyCouponBtn = document.getElementById('applyCoupon');
    const cartCity = document.getElementById('cartCity');

    // Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§
    const loginBtn = document.getElementById('loginBtn');
    const loginBtnMobile = document.getElementById('loginBtnMobile');
    const loginModal = document.getElementById('loginModal');
    const slotsModal = document.getElementById('slotsModal');
    const openSlots = document.getElementById('openSlots');
    const openSlots2 = document.getElementById('openSlots2');
    const orderDone = document.getElementById('orderDone');
    const slotGrid = document.getElementById('slotGrid');

    // Ø­Ø§Ù„Øª Ø¨Ø±Ù†Ø§Ù…Ù‡
    let state = {
      cat: 'all',
      q: '',
      cart: {}, // id -> qty
      coupon: null,
      city: 'ØªÙ‡Ø±Ø§Ù†',
      slot: null,
    };

    // Ø±Ù†Ø¯Ø± Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§
    function renderCats() {
      catWrap.innerHTML = '';
      categories.forEach(c => {
        const btn = document.createElement('button');
        btn.className = 'rounded-full border px-4 py-2 text-sm hover:bg-gray-50 ' + (state.cat===c.id? 'bg-gray-900 text-white border-gray-900':'');
        btn.textContent = c.name;
        btn.onclick = () => { state.cat = c.id; renderProducts(); };
        catWrap.appendChild(btn);
      });
    }

    // ÙÛŒÙ„ØªØ± Ù…Ø­ØµÙˆÙ„Ø§Øª
    function filteredProducts() {
      return products.filter(p => {
        const byCat = state.cat==='all' || p.cat===state.cat;
        const byQ = !state.q || p.title.includes(state.q);
        return byCat && byQ;
      });
    }

    // Ø±Ù†Ø¯Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª
    function renderProducts() {
      const list = filteredProducts();
      grid.innerHTML = '';
      list.forEach(p => {
        const card = document.createElement('div');
        card.className = 'rounded-2xl bg-white border p-3 flex flex-col';
        card.innerHTML = `
          <div class="text-5xl text-center">${p.emoji}</div>
          <div class="mt-3 font-bold">${p.title}</div>
          <div class="text-sm text-gray-500">${p.unit}</div>
          <div class="mt-2 font-bold">${p.price.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</div>
          <div class="mt-auto pt-3">
            <button class="w-full rounded-xl bg-primary hover:bg-primaryDark text-white py-2 addBtn">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯</button>
          </div>`;
        card.querySelector('.addBtn').onclick = () => addToCart(p.id, 1);
        grid.appendChild(card);
      });
    }

    // Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
    function addToCart(id, qty=1){
      state.cart[id] = (state.cart[id]||0) + qty;
      if(state.cart[id] <= 0) delete state.cart[id];
      renderCart();
      openCart();
    }

    function cartLines(){
      return Object.entries(state.cart).map(([id,qty])=>{
        const p = products.find(x=>x.id==id);
        const lineTotal = p.price * qty;
        return {id:+id, p, qty, lineTotal};
      });
    }

    function totals(){
      const lines = cartLines();
      const subtotal = lines.reduce((s,l)=>s+l.lineTotal,0);
      const discount = state.coupon ? Math.floor(subtotal * state.coupon) : 0;
      const shipping = subtotal>0 ? shippingBase : 0;
      const payable = Math.max(0, subtotal - discount + shipping);
      return {subtotal, discount, shipping, payable};
    }

    function renderCart(){
      const lines = cartLines();
      cartItems.innerHTML = '';
      if(lines.length===0){
        cartItems.innerHTML = '<div class="text-center text-gray-500 py-10">Ø³Ø¨Ø¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</div>';
      }
      lines.forEach(({id, p, qty, lineTotal})=>{
        const row = document.createElement('div');
        row.className = 'border rounded-2xl p-3 flex items-center gap-3';
        row.innerHTML = `
          <div class="text-3xl">${p.emoji}</div>
          <div class="flex-1">
            <div class="font-semibold">${p.title}</div>
            <div class="text-sm text-gray-500">${p.unit}</div>
            <div class="mt-1 text-sm">${(p.price).toLocaleString('fa-IR')} Ã— ${qty} = <b>${lineTotal.toLocaleString('fa-IR')}</b> ØªÙˆÙ…Ø§Ù†</div>
          </div>
          <div class="flex items-center gap-2">
            <button class="px-3 py-1 rounded-full border" aria-label="Ú©Ù… Ú©Ø±Ø¯Ù†">âˆ’</button>
            <span class="w-6 text-center">${qty}</span>
            <button class="px-3 py-1 rounded-full border" aria-label="Ø²ÛŒØ§Ø¯ Ú©Ø±Ø¯Ù†">+</button>
          </div>`;
        const [minusBtn, , plusBtn] = row.querySelectorAll('button');
        minusBtn.onclick = ()=>{ addToCart(id, -1); };
        plusBtn.onclick = ()=>{ addToCart(id, +1); };
        cartItems.appendChild(row);
      });

      const t = totals();
      subtotalEl.textContent = t.subtotal.toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†';
      discountEl.textContent = t.discount.toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†';
      shippingEl.textContent = t.shipping.toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†';
      payableEl.textContent = t.payable.toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†';
      floatingCart.classList.toggle('hidden', lines.length===0);
    }

    function openCart(){ cartDrawer.style.transform = 'translateX(0)'; }
    function closeCartDrawer(){ cartDrawer.style.transform = 'translateX(-110%)'; }

    // Ú©ÙˆÙ¾Ù†
    applyCouponBtn.onclick = () => {
      const code = (couponInput.value||'').toUpperCase().trim();
      if(coupons[code]){ state.coupon = coupons[code]; alert('Ú©Ø¯ ØªØ®ÙÛŒÙ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯'); }
      else { state.coupon = null; alert('Ú©Ø¯ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª'); }
      renderCart();
    };

    // Ø¬Ø³ØªØ¬Ùˆ
    function bindSearch(inp){
      if(!inp) return;
      inp.addEventListener('input', (e)=>{ state.q = e.target.value.trim(); renderProducts(); });
    }

    // Ø´Ù‡Ø±
    function bindCity(sel){
      if(!sel) return;
      sel.addEventListener('change', (e)=>{
        state.city = e.target.value;
        cartCity.textContent = 'Ø´Ù‡Ø±: ' + state.city;
      });
    }

    // Ø§Ø³Ù„Ø§Øªâ€ŒÙ‡Ø§
    function renderSlots(){
      slotGrid.innerHTML = '';
      const today = new Date();
      const days = [...Array(5)].map((_,i)=>{
        const d = new Date(today); d.setDate(d.getDate()+i);
        return d;
      });
      const slots = ['Û¹-Û±Û±','Û±Û±-Û±Û³','Û±Û³-Û±Ûµ','Û±Ûµ-Û±Û·','Û±Û·-Û±Û¹','Û±Û¹-Û²Û±'];
      days.forEach(d=>{
        slots.forEach(s=>{
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'rounded-xl border px-3 py-2 hover:bg-gray-50 text-sm';
          const label = d.toLocaleDateString('fa-IR') + ' | ' + s;
          btn.textContent = label;
          btn.onclick = ()=>{
            state.slot = label;
            [...slotGrid.children].forEach(x=>x.classList.remove('bg-gray-900','text-white','border-gray-900'));
            btn.classList.add('bg-gray-900','text-white','border-gray-900');
          };
          slotGrid.appendChild(btn);
        });
      });
    }

    // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
    cartBtnTop && (cartBtnTop.onclick = openCart);
    cartBtnBottom && (cartBtnBottom.onclick = openCart);
    floatingCart && (floatingCart.onclick = openCart);
    closeCart && (closeCart.onclick = closeCartDrawer);

    loginBtn && (loginBtn.onclick = ()=>loginModal.showModal());
    loginBtnMobile && (loginBtnMobile.onclick = ()=>loginModal.showModal());

    openSlots && (openSlots.onclick = ()=>{ renderSlots(); slotsModal.showModal(); });
    openSlots2 && (openSlots2.onclick = ()=>{ renderSlots(); slotsModal.showModal(); });

    document.getElementById('checkout').onclick = ()=>{
      if(Object.keys(state.cart).length===0){ alert('Ø³Ø¨Ø¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª'); return; }
      orderDone.showModal();
      // Ø±ÛŒØ³Øª Ø¯Ù…Ùˆ
      state.cart = {}; state.coupon=null; renderCart(); closeCartDrawer();
    };

    // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    renderCats();
    renderProducts();
    renderCart();
    bindSearch(search); bindSearch(searchMobile);
    bindCity(city); bindCity(cityMobile);
    cartCity.textContent = 'Ø´Ù‡Ø±: ' + state.city;
  </script> 
 </body>
</html>
